<style>
    :root {
        --primary-color: #7d8e3c;
        --primary-light: #d4deb8;
        --secondary-color: #5a6b28;
        --text-dark: #202124;
        --text-light: #5f6368;
        --border-color: #dadce0;
        --background-light: #f8f9fa;
        --success-color: #34a853;
        --warning-color: #f9ab00;
        --danger-color: #ea4335;
    }

    body {
        background: linear-gradient(135deg, #f5f8ed 0%, #e8f0dc 100%);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        padding: 20px 0;
    }

    .evaluation-container {
        max-width: 900px;
        margin: 30px auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .form-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .form-header h1 {
        margin: 0 0 10px 0;
        font-size: 28px;
        font-weight: 600;
    }

    .form-header p {
        margin: 0;
        opacity: 0.9;
        font-size: 16px;
    }

    .form-content {
        padding: 40px;
    }

    .info-card {
        background: var(--background-light);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
    }

    .info-item label {
        font-weight: 600;
        color: var(--text-light);
        font-size: 14px;
        margin-bottom: 5px;
    }

    .info-item .value {
        font-weight: 500;
        color: var(--text-dark);
        font-size: 16px;
    }

    .form-section {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .form-section:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--primary-light);
    }

    .section-number {
        background: var(--primary-color);
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-right: 15px;
        font-size: 14px;
    }

    .section-header h4 {
        margin: 0;
        color: var(--text-dark);
        font-size: 20px;
        font-weight: 600;
    }

    .question-group {
        margin-bottom: 35px;
        padding: 20px;
        background: var(--background-light);
        border-radius: 10px;
        border-left: 4px solid var(--primary-color);
    }

    .question-text {
        font-weight: 500;
        color: var(--text-dark);
        margin-bottom: 20px;
        font-size: 16px;
        line-height: 1.5;
    }

    .question-group > .question-text:first-of-type {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
    }

    .rating-options {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .rating-option {
        position: relative;
    }

    .rating-option input[type="radio"] {
        display: none;
    }

    .rating-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px 20px;
        background: white;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 80px;
        text-align: center;
    }

    .rating-label:hover {
        border-color: var(--primary-light);
        transform: translateY(-2px);
    }

    .rating-option input[type="radio"]:checked + .rating-label {
        background: var(--primary-light);
        border-color: var(--primary-color);
        color: var(--primary-color);
        font-weight: 600;
    }

    .rating-value {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .rating-text {
        font-size: 12px;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .scale-guide {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .scale-guide h5 {
        margin: 0 0 15px 0;
        font-size: 18px;
        text-align: center;
    }

    .scale-items {
        display: flex;
        justify-content: center;
        gap: 20px;
        text-align: center;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 10px 0;
    }

    .scale-item {
        padding: 10px;
        flex-shrink: 0;
        min-width: 80px;
    }

    .scale-value {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .scale-description {
        font-size: 13px;
        opacity: 0.9;
    }

    .submit-section {
        text-align: center;
        padding: 30px 0 10px 0;
    }

    .submit-btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border: none;
        padding: 16px 40px;
        font-size: 18px;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(103, 58, 183, 0.3);
    }

    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(103, 58, 183, 0.4);
    }

    .submit-btn:active {
        transform: translateY(0);
    }

    .warning-message {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        text-align: center;
        display: none;
    }

    .form-control {
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 15px;
        transition: border-color 0.3s ease;
        max-width: 100%;
        width: 100%;
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(103, 58, 183, 0.1);
    }

    /* Select dropdown specific styling */
    select.form-control {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* Handle long option text */
    select.form-control option {
        padding: 5px;
        word-wrap: normal;
    }

    .comments-section {
        background: #f0f7ff;
        border: 2px solid #1a73e8;
        border-radius: 12px;
        padding: 25px;
        margin: 30px 0;
    }

    .comments-section h5 {
        color: #1a73e8;
        margin-bottom: 15px;
        font-size: 18px;
    }

    .comments-section textarea {
        width: 100%;
        min-height: 120px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        font-size: 15px;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s ease;
    }

    .comments-section textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(103, 58, 183, 0.1);
        outline: none;
    }

    .comments-note {
        color: var(--text-light);
        font-size: 13px;
        margin-top: 10px;
        font-style: italic;
    }

    .form-text {
        font-size: 12px;
        display: block;
        margin-top: 8px;
    }

    .form-text.text-muted {
        color: var(--text-light);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        body {
            padding: 10px 0;
        }
        
        .evaluation-container {
            margin: 10px;
            border-radius: 12px;
        }

        .form-content {
            padding: 15px;
        }

        .form-header {
            padding: 20px 15px;
        }

        .form-header h1 {
            font-size: 22px;
        }

        .form-header p {
            font-size: 14px;
        }

        .info-card {
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .info-item label {
            font-size: 13px;
        }

        .info-item .value {
            font-size: 15px;
        }

        .form-section {
            padding: 20px 15px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .section-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
        }

        .section-number {
            width: 28px;
            height: 28px;
            font-size: 12px;
            margin-right: 12px;
        }

        .section-header h4 {
            font-size: 18px;
        }

        .question-group {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 8px;
        }

        /* IMPORTANT: Make question text larger and more readable on tablets */
        .question-text {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.6;
        }

        .question-group > .question-text:first-of-type {
            font-size: 17px;
            font-weight: 600;
        }

        .rating-options {
            gap: 10px;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .rating-label {
            min-width: 65px;
            padding: 10px 8px;
            font-size: 13px;
        }

        .rating-value {
            font-size: 22px;
        }

        .rating-text {
            font-size: 10px;
        }

        .scale-guide {
            padding: 20px;
            margin-bottom: 25px;
        }

        .scale-guide h5 {
            margin: 0 0 12px 0;
            font-size: 16px;
        }

        .scale-items {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 8px 0;
        }

        .scale-item {
            padding: 10px;
        }

        .scale-value {
            font-size: 20px;
        }

        .scale-description {
            font-size: 12px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px 20px;
            font-size: 16px;
        }

        .comments-section {
            padding: 20px 15px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .comments-section h5 {
            font-size: 16px;
            margin-bottom: 12px;
        }

        .comments-section textarea {
            min-height: 100px;
            font-size: 14px;
            padding: 12px;
        }

        .form-control {
            padding: 12px;
            font-size: 15px;
        }
    }

    @media (max-width: 480px) {
        .evaluation-container {
            margin: 10px;
            border-radius: 10px;
        }

        .form-control {
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 14px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        select.form-control {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 1.5em;
            padding-right: 2.5rem;
        }

    @media (max-width: 480px) {
        .evaluation-container {
            margin: 5px;
            border-radius: 10px;
        }

        .form-content {
            padding: 12px;
        }

        .form-header {
            padding: 15px 12px;
        }

        .form-header h1 {
            font-size: 20px;
            margin: 0 0 8px 0;
        }

        .form-header p {
            font-size: 13px;
            opacity: 0.95;
        }

        .info-card {
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .info-item label {
            font-size: 12px;
            margin-bottom: 3px;
        }

        .info-item .value {
            font-size: 14px;
        }

        .form-section {
            padding: 15px 12px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .section-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
        }

        .section-number {
            width: 26px;
            height: 26px;
            font-size: 11px;
            margin-right: 10px;
        }

        .section-header h4 {
            font-size: 16px;
        }

        .question-group {
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }

        /* CRITICAL: Extra large text for very small screens */
        .question-text {
            font-size: 17px;
            margin-bottom: 15px;
            line-height: 1.7;
            font-weight: 600;
        }

        .question-group > .question-text:first-of-type {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .rating-options {
            flex-direction: column;
            align-items: stretch;
            gap: 8px;
        }

        .rating-option {
            position: relative;
        }

        .rating-label {
            width: 100%;
            max-width: 100%;
            flex-direction: row;
            justify-content: space-between;
            padding: 14px 18px;
            font-size: 13px;
            border-radius: 8px;
        }

        .rating-value {
            font-size: 24px;
            margin-bottom: 0;
        }

        .rating-text {
            font-size: 13px;
            text-align: right;
        }

        .scale-guide {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .scale-guide h5 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .scale-items {
            grid-template-columns: 1fr;
            gap: 8px;
            padding: 5px 0;
        }

        .scale-item {
            padding: 8px;
        }

        .scale-value {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .scale-description {
            font-size: 11px;
        }

        .submit-section {
            padding: 20px 0 10px 0;
            text-align: center;
        }

        .submit-btn {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border-radius: 8px;
        }

        .submit-section p {
            font-size: 12px;
            margin-top: 12px;
        }

        .comments-section {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 2px solid #1a73e8;
        }

        .comments-section h5 {
            font-size: 15px;
            margin-bottom: 10px;
            margin-top: 0;
        }

        .comments-section p {
            font-size: 13px;
            margin: 10px 0;
        }

        .comments-section textarea {
            width: 100%;
            min-height: 90px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
        }

        .comments-note {
            font-size: 12px;
            margin-top: 8px;
        }

        .form-control {
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 14px;
            width: 100%;
        }

        .warning-message {
            padding: 12px;
            margin: 12px 0;
            font-size: 13px;
            border-radius: 6px;
        }
    }

    @media (max-width: 360px) {
        .evaluation-container {
            margin: 5px;
        }

        .form-content {
            padding: 12px;
        }

        .form-header {
            padding: 12px;
        }

        .form-header h1 {
            font-size: 18px;
        }

        .section-number {
            width: 24px;
            height: 24px;
            font-size: 10px;
            margin-right: 8px;
        }

        .section-header h4 {
            font-size: 15px;
        }

        .question-text {
            font-size: 13px;
        }

        .rating-label {
            min-width: 45px;
            padding: 8px 8px;
            font-size: 11px;
        }

        .scale-item {
            min-width: 50px;
        }
    }

    /* Animation for form sections */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-section {
        animation: fadeInUp 0.5s ease forwards;
    }

    .form-section:nth-child(2) { animation-delay: 0.1s; }
    .form-section:nth-child(3) { animation-delay: 0.2s; }
    .form-section:nth-child(4) { animation-delay: 0.3s; }
    .form-section:nth-child(5) { animation-delay: 0.4s; }
</style>

<div class="evaluation-container">
    <div class="form-header">
        <h1>üìù Faculty Evaluation Form</h1>
        <p>Your feedback helps improve teaching quality and learning experience</p>
    </div>

    <div class="form-content">
        <!-- Display Messages -->
        {% if messages %}
        <div id="messageContainer" class="mb-3">
            {% for message in messages %}
                {% if message.tags == 'success' %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" style="border-radius: 12px; padding: 20px; font-size: 1.1rem; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 5px solid #28a745;">
                    <i class="fas fa-check-circle" style="font-size: 1.3rem; margin-right: 10px;"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% elif message.tags == 'error' or message.tags == 'danger' %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert" style="border-radius: 12px; padding: 20px; font-size: 1.1rem; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 5px solid #dc3545;">
                    <i class="fas fa-exclamation-circle" style="font-size: 1.3rem; margin-right: 10px;"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% else %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" style="border-radius: 12px; padding: 20px; font-size: 1.1rem; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 5px solid #0d6efd;">
                    <i class="fas fa-info-circle" style="font-size: 1.3rem; margin-right: 10px;"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endif %}
            {% endfor %}
        </div>
        <style>
            @keyframes slideInDown {
                from {
                    transform: translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const messageContainer = document.getElementById('messageContainer');
                if (messageContainer) {
                    // Scroll to top to ensure message is visible
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // Add animation
                    messageContainer.style.animation = 'slideInDown 0.5s ease-out';
                    
                    // Auto-dismiss success messages after 5 seconds
                    const successAlerts = messageContainer.querySelectorAll('.alert-success');
                    successAlerts.forEach(function(alert) {
                        setTimeout(function() {
                            const bsAlert = new bootstrap.Alert(alert);
                            bsAlert.close();
                        }, 5000);
                    });
                }
            });
        </script>
        {% endif %}
        
        <!-- Student Information Card -->
        <div class="info-card">
            <div class="info-grid">
                <div class="info-item">
                    <label>Student Number</label>
                    <div class="value">{{ student_number }}</div>
                </div>
                <div class="info-item">
                    <label>Your Section</label>
                    <div class="value">{{ student_section }}</div>
                </div>
            </div>
            <small style="color: var(--text-light); font-style: italic;">
                üí° Your information is pre-filled from your account profile
            </small>
        </div>

        <!-- FORM STARTS HERE - Everything inside the form -->
        <form method="POST" action="{% url 'main:submit_evaluation' %}">
            {% csrf_token %}
            <input type="hidden" name="studentNumber" value="{{ student_number }}">
            <input type="hidden" name="student_section" value="{{ student_section }}">

            <!-- Instructor Selection INSIDE the form -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-number">üë®‚Äçüè´</div>
                    <h4>Select Instructor</h4>
                </div>
                <div class="question-group">
                    <label class="question-text">Choose the instructor you want to evaluate:</label>
                    <input type="hidden" name="evaluatee" id="evaluatee" required>
                    
                    <div class="instructors-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; max-height: 600px; overflow-y: auto; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px; background: #fafafa;">
                        {% for user in faculty %}
                            <div class="instructor-card {% if user.id in evaluated_ids %}evaluated{% endif %}" 
                                 data-instructor-id="{{ user.id }}"
                                 style="border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; {% if user.id in evaluated_ids %}opacity: 0.5; cursor: not-allowed; background: #f5f5f5;{% else %}background: white;{% endif %}">
                                
                                {% if user.userprofile.profile_picture %}
                                    <img src="{{ user.userprofile.profile_picture.url }}" alt="{{ user.get_full_name }}" 
                                         style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 15px; display: block; border: 3px solid #7d8e3c;">
                                {% else %}
                                    <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #7d8e3c, #5a6b28); color: white; display: flex; align-items: center; justify-content: center; font-size: 40px; font-weight: bold; margin: 0 auto 15px; border: 3px solid #7d8e3c;">
                                        {{ user.get_full_name|default:user.username|slice:":1"|upper }}
                                    </div>
                                {% endif %}
                                
                                <h6 style="margin: 10px 0 5px; font-weight: 600; color: #202124;">{{ user.get_full_name|default:user.username }}</h6>
                                <p style="margin: 0; font-size: 13px; color: #5f6368;">{{ user.userprofile.role }}</p>
                                
                                {% if user.id in evaluated_ids %}
                                    <span style="display: inline-block; margin-top: 10px; padding: 5px 12px; background: #ea4335; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                        ‚úì Already Evaluated
                                    </span>
                                {% else %}
                                    <span class="select-badge" style="display: none; margin-top: 10px; padding: 5px 12px; background: #34a853; color: white; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                        ‚úì Selected
                                    </span>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    
                    <small class="form-text text-muted" style="display: block; margin-top: 15px;">
                        Click on an instructor's card to select them. You can only evaluate each instructor once per evaluation period.
                    </small>
                </div>
            </div>

            <!-- Rating Scale Guide -->
            <div class="scale-guide">
                <h5>üìä Rating Scale Guide</h5>
                <div class="scale-items">
                    <div class="scale-item">
                        <div class="scale-value">5</div>
                        <div class="scale-description">Outstanding</div>
                    </div>
                    <div class="scale-item">
                        <div class="scale-value">4</div>
                        <div class="scale-description">Very Satisfactory</div>
                    </div>
                    <div class="scale-item">
                        <div class="scale-value">3</div>
                        <div class="scale-description">Satisfactory</div>
                    </div>
                    <div class="scale-item">
                        <div class="scale-value">2</div>
                        <div class="scale-description">Unsatisfactory</div>
                    </div>
                    <div class="scale-item">
                        <div class="scale-value">1</div>
                        <div class="scale-description">Poor</div>
                    </div>
                </div>
            </div>

            <!-- All 19 Evaluation Questions (Dynamic from Database) -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-number">üìã</div>
                    <h4>Teacher Evaluation</h4>
                </div>

                {% for question in questions %}
                <div class="question-group">
                    <div class="question-text">{{ question.question_text }}</div>
                    <div class="rating-options">
                        {% for i in "54321" %}
                        <div class="rating-option">
                            <input type="radio" name="question{{ question.question_number }}" value="{{ i }}" id="q{{ question.question_number }}_{{ i }}">
                            <label class="rating-label" for="q{{ question.question_number }}_{{ i }}">
                                <span class="rating-value">{{ i }}</span>
                                <span class="rating-text">
                                    {% if i == "5" %}Outstanding
                                    {% elif i == "4" %}Very Sat
                                    {% elif i == "3" %}Satisfactory
                                    {% elif i == "2" %}Unsat
                                    {% else %}Poor{% endif %}
                                </span>
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
                <h5>üí¨ Additional Comments (Optional)</h5>
                <p class="question-text">Please provide any additional feedback or suggestions in English to help the instructor improve:</p>
                <textarea 
                    name="comments" 
                    placeholder="Enter your comments here... 
                    
What did you like most about this instructor?
What areas could be improved?
Any specific suggestions for enhancement?
                    
Your comments will be anonymous and used constructively to improve teaching quality."
                    maxlength="1000"
                ></textarea>
                <div class="comments-note">
                    üìù Maximum 1000 characters. Your comments will be reviewed anonymously.
                </div>
            </div>

            <div class="warning-message" id="already-evaluated-msg">
                ‚ö†Ô∏è You have already evaluated this instructor. Please select a different instructor.
            </div>

            <div class="submit-section">
                <button type="submit" class="submit-btn">
                    üöÄ Submit Evaluation
                </button>
                <p style="color: var(--text-light); margin-top: 15px; font-size: 14px;">
                    Your responses are anonymous and will be used to improve teaching quality
                </p>
            </div>
        </form>
        <!-- FORM ENDS HERE -->
    </div>
</div>

<script>
    const evaluatedIds = {{ evaluated_ids|safe }};
    const evaluateeInput = document.getElementById("evaluatee");
    const warningMsg = document.getElementById("already-evaluated-msg");
    
    // Handle instructor card selection
    document.querySelectorAll('.instructor-card').forEach(card => {
        if (!card.classList.contains('evaluated')) {
            card.addEventListener('click', function() {
                const instructorId = this.getAttribute('data-instructor-id');
                
                // Remove selection from all cards
                document.querySelectorAll('.instructor-card').forEach(c => {
                    c.style.border = '2px solid #e0e0e0';
                    c.style.background = 'white';
                    const badge = c.querySelector('.select-badge');
                    if (badge) badge.style.display = 'none';
                });
                
                // Mark this card as selected
                this.style.border = '2px solid #7d8e3c';
                this.style.background = '#f5f8ed';
                const selectBadge = this.querySelector('.select-badge');
                if (selectBadge) selectBadge.style.display = 'inline-block';
                
                // Set the hidden input value
                evaluateeInput.value = instructorId;
                
                // Hide warning if shown
                warningMsg.style.display = "none";
            });
            
            // Hover effects
            card.addEventListener('mouseenter', function() {
                if (!this.style.border.includes('7d8e3c')) {
                    this.style.border = '2px solid #7d8e3c';
                    this.style.transform = 'translateY(-5px)';
                    this.style.boxShadow = '0 8px 20px rgba(0,0,0,0.15)';
                }
            });
            
            card.addEventListener('mouseleave', function() {
                if (!evaluateeInput.value || evaluateeInput.value !== this.getAttribute('data-instructor-id')) {
                    this.style.border = '2px solid #e0e0e0';
                    this.style.transform = '';
                    this.style.boxShadow = '';
                }
            });
        }
    });

    // Form submission validation and logging
    document.querySelector('form').addEventListener('submit', function(e) {
        console.log('Form submit event triggered');
        
        // Remove any existing error messages
        const existingError = document.querySelector('.validation-error-message');
        if (existingError) {
            existingError.remove();
        }
        
        // Remove highlighting from all questions
        document.querySelectorAll('.question-group').forEach(q => {
            q.style.border = '';
            q.style.backgroundColor = '';
        });
        
        // Check if instructor is selected
        const selectedInstructor = evaluateeInput.value;
        if (!selectedInstructor) {
            e.preventDefault();
            alert('‚ö†Ô∏è Please select an instructor to evaluate before submitting.');
            document.querySelector('.instructors-grid').scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        // Check if already evaluated
        if (evaluatedIds.includes(parseInt(selectedInstructor))) {
            e.preventDefault();
            alert('‚ö†Ô∏è You have already evaluated this instructor. Please select a different instructor.');
            return false;
        }

        // Check if all questions are answered
        // Only select question groups that have radio buttons (actual evaluation questions)
        const allQuestions = document.querySelectorAll('.question-group');
        const unansweredQuestions = [];
        let questionCounter = 0;
        
        allQuestions.forEach((questionGroup) => {
            // Check if this question group has radio buttons
            const hasRadios = questionGroup.querySelector('input[type="radio"]');
            if (hasRadios) {
                questionCounter++;
                // Find any radio button within this question group that is checked
                const answered = questionGroup.querySelector('input[type="radio"]:checked');
                if (!answered) {
                    unansweredQuestions.push(questionCounter);
                }
            }
        });
        
        if (unansweredQuestions.length > 0) {
            e.preventDefault();
            
            console.log('Unanswered questions:', unansweredQuestions);
            
            // Highlight unanswered questions
            let highlightCounter = 0;
            allQuestions.forEach(questionGroup => {
                const hasRadios = questionGroup.querySelector('input[type="radio"]');
                if (hasRadios) {
                    highlightCounter++;
                    if (unansweredQuestions.includes(highlightCounter)) {
                        questionGroup.style.border = '2px solid #ea4335';
                        questionGroup.style.backgroundColor = '#fff3f3';
                    }
                }
            });
            
            // Show alert message
            const questionText = unansweredQuestions.length === 1 
                ? `Question ${unansweredQuestions[0]}` 
                : `${unansweredQuestions.length} questions`;
            
            alert(`‚ö†Ô∏è Please answer all questions before submitting.\n\nYou missed: ${questionText}`);
            
            // Scroll to first unanswered question
            let scrollCounter = 0;
            for (const questionGroup of allQuestions) {
                const hasRadios = questionGroup.querySelector('input[type="radio"]');
                if (hasRadios) {
                    scrollCounter++;
                    if (scrollCounter === unansweredQuestions[0]) {
                        questionGroup.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        break;
                    }
                }
            }
            return false;
        }

        console.log('All validations passed, submitting form...');
    });

    // Add smooth scrolling to form sections
    document.querySelectorAll('.rating-label').forEach(label => {
        label.addEventListener('click', function() {
            this.closest('.question-group').style.backgroundColor = '#f8f9fa';
            setTimeout(() => {
                this.closest('.question-group').style.backgroundColor = '';
            }, 300);
        });
    });

    // Character counter for comments
    const commentsTextarea = document.querySelector('textarea[name="comments"]');
    const commentCounter = document.createElement('div');
    commentCounter.className = 'comments-note';
    commentCounter.style.marginTop = '5px';
    commentsTextarea.parentNode.insertBefore(commentCounter, commentsTextarea.nextSibling);

    commentsTextarea.addEventListener('input', function() {
        const remaining = 1000 - this.value.length;
        commentCounter.textContent = `${remaining} characters remaining`;
        if (remaining < 100) {
            commentCounter.style.color = '#ea4335';
        } else if (remaining < 300) {
            commentCounter.style.color = '#f9ab00';
        } else {
            commentCounter.style.color = 'var(--text-light)';
        }
    });
</script>