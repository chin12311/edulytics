{% extends 'registration/login_base.html' %}

{% block title %} Login {% endblock %}
{% load crispy_forms_tags %}
{% load static %}

{% block body_style %}
    style="background-image: url('{% static 'img/camp.jpg' %}'); background-repeat: no-repeat; background-size: cover; background-position: center; min-height: 100vh;"
{% endblock %}

{% block content %}
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="login-box row w-100 shadow-lg rounded-3 overflow-hidden" style="background-color: rgba(255, 255, 255, 0.4);">

        <!-- Left Side: Edulytics and Logo -->
        <div class="col-12 col-md-6 d-flex flex-column justify-content-center align-items-center p-4" style="background-color: rgba(245, 245, 245, 0.6); color: #333;">
            <div class="text-center">
                <img src="{% static 'img/cca-logo.png' %}" alt="CCA Logo" class="img-fluid mb-3" style="max-width: 180px;">
                <h4>Edulytics</h4>
                <p class="small">Edulytics helps educators improve teaching methods using AI-driven recommendations based on faculty evaluation results. It provides personalized suggestions to enhance instruction and learning outcomes.</p>
            </div>
        </div>

        <!-- Right Side: Login Form -->
        <div class="col-12 col-md-6 p-4 d-flex flex-column justify-content-center align-items-center" style="background-color: rgba(71, 104, 44, 0.9); color: white;">
            <div class="form-container w-100" style="max-width: 400px;">
                <h2 class="text-center mb-4" style="font-size: 1.8rem;">City College Of Angeles</h2>
                
                <!-- Display non-field errors with close button -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger alert-dismissible fade show mb-3" role="alert" id="login-error">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Incorrect Username or Password. Please try again.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endif %}

                <form action="{% url 'register:login' %}" method="POST">
                    {% csrf_token %}

                    <div class="form-group">
                        <input type="email" name="email" id="id_email" value="{{ form.email.value|default:'' }}" class="form-control {% if form.non_field_errors %}error-border{% endif %} {% if form.email.errors %}is-invalid{% endif %}" placeholder="Email Address">
                        {% if form.email.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.email.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group mt-3">
                        <div class="position-relative">
                            <input type="password" name="password" id="id_password" class="form-control {% if form.non_field_errors %}error-border{% endif %} {% if form.password.errors %}is-invalid{% endif %}" placeholder="Password" maxlength="20" style="padding-right: 45px;">
                            <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y" id="togglePassword" style="border: none; background: none; z-index: 10; padding-right: 15px;">
                                <i class="fas fa-eye" id="eyeIcon" style="color: #666;"></i>
                            </button>
                        </div>
                        {% if form.password.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.password.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <input type="hidden" name="next" value="{{ request.GET.next }}">

                    <div class="form-group text-center mt-4">
                        <button type="submit" class="btn btn-light w-100" style="color: #47682c; font-weight: bold;">Login</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Add Bootstrap JavaScript for alert dismiss functionality -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
    .alert {
        border-radius: 8px;
        border: none;
    }
    
    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
    }
    
    /* Red border for input boxes when there's a login error */
    .error-border {
        border: 2px solid #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
        background-color: #fff5f5;
    }
    
    .error-border:focus {
        border: 2px solid #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
    
    .is-invalid {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
    
    .invalid-feedback {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        font-weight: 500;
    }
    
    .form-control {
        border-radius: 8px;
        padding: 12px 15px;
        border: 2px solid transparent;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        border-color: #47682c;
        box-shadow: 0 0 0 0.2rem rgba(71, 104, 44, 0.25);
    }
    
    .btn-close:focus {
        box-shadow: none;
    }
    
    /* Password toggle button styling */
    #togglePassword {
        cursor: pointer;
        padding: 0;
        margin: 0;
        height: 100%;
    }
    
    #togglePassword:hover #eyeIcon {
        color: #47682c;
    }
    
    #togglePassword:focus {
        outline: none;
        box-shadow: none;
    }
    
    /* Animation for error state */
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .error-border {
        animation: shake 0.5s ease-in-out;
    }
</style>

<script>
    // Add shake effect when page loads with errors
    document.addEventListener('DOMContentLoaded', function() {
        const errorInputs = document.querySelectorAll('.error-border');
        errorInputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.style.animation = 'none';
                setTimeout(() => {
                    this.style.animation = 'shake 0.5s ease-in-out';
                }, 10);
            });
        });
        
        // Toggle password visibility
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('id_password');
        const eyeIcon = document.getElementById('eyeIcon');
        
        if (togglePassword) {
            togglePassword.addEventListener('click', function() {
                // Toggle the type attribute
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Toggle the eye icon
                if (type === 'password') {
                    eyeIcon.classList.remove('fa-eye-slash');
                    eyeIcon.classList.add('fa-eye');
                } else {
                    eyeIcon.classList.remove('fa-eye');
                    eyeIcon.classList.add('fa-eye-slash');
                }
            });
        }
    });
</script>

{% endblock %}